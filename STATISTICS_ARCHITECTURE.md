# ğŸ“Š STATISTICS TRACKING SYSTEM - ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       LEARN QUIZ ENGLISH APP                             â”‚
â”‚                     Statistics Tracking System                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER ACTIVITIES                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ“š Reading          ğŸ§ Listening        ğŸ¯ Quiz           ğŸ“ Words
    Exercise            Exercise            Completion         Management
       â”‚                    â”‚                   â”‚                  â”‚
       â”‚                    â”‚                   â”‚                  â”‚
       â–¼                    â–¼                   â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATABASE TABLES                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚user_progress â”‚   â”‚user_progress â”‚   â”‚user_quiz_attemptsâ”‚   â”‚user_   â”‚â”‚
â”‚  â”‚              â”‚   â”‚              â”‚   â”‚                 â”‚   â”‚words   â”‚â”‚
â”‚  â”‚content_type: â”‚   â”‚content_type: â”‚   â”‚user_id          â”‚   â”‚        â”‚â”‚
â”‚  â”‚'reading'     â”‚   â”‚'listening'   â”‚   â”‚quiz_id          â”‚   â”‚user_id â”‚â”‚
â”‚  â”‚completed:trueâ”‚   â”‚completed:trueâ”‚   â”‚score            â”‚   â”‚word    â”‚â”‚
â”‚  â”‚level: 'B1'   â”‚   â”‚level: 'A2'   â”‚   â”‚created_at       â”‚   â”‚categoryâ”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚
â”‚         â”‚                  â”‚                     â”‚                 â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                     â”‚                 â”‚
          â”‚                  â”‚                     â”‚           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
          â”‚                  â”‚                     â”‚           â”‚  INSERT   â”‚
          â”‚                  â”‚                     â”‚           â”‚  DELETE   â”‚
          â”‚                  â”‚                     â”‚           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
          â–¼                  â–¼                     â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      POSTGRESQL TRIGGERS                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  trigger_reading_completed()      trigger_listening_completed()          â”‚
â”‚          â”‚                                â”‚                              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                       â”‚                                                   â”‚
â”‚                       â”‚       trigger_quiz_completed()                   â”‚
â”‚                       â”‚                â”‚                                 â”‚
â”‚                       â”‚                â”‚                                 â”‚
â”‚        trigger_word_added()     trigger_word_deleted()                   â”‚
â”‚                â”‚                        â”‚                                â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                             â”‚                                            â”‚
â”‚                             â–¼                                            â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                  â”‚ increment_statistics()â”‚                               â”‚
â”‚                  â”‚ update_usage_days()  â”‚                               â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USER_STATISTICS TABLE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  user_id                      (uuid, PRIMARY KEY)                       â”‚
â”‚  total_reading_completed      â† Auto increment on reading complete      â”‚
â”‚  total_listening_completed    â† Auto increment on listening complete    â”‚
â”‚  total_quizzes_completed      â† Auto increment on quiz submit           â”‚
â”‚  total_quiz_score             â† Auto add score on quiz submit           â”‚
â”‚  total_words_added            â† Auto +1 on add, -1 on delete            â”‚
â”‚  flashcard_practice_count     â† Manual: trackFlashcardSession()         â”‚
â”‚  total_usage_days             â† Auto increment on new day activity      â”‚
â”‚  last_activity_date           â† Auto update on any activity             â”‚
â”‚  most_studied_level           â† Manual: updateMostStudiedLevel()        â”‚
â”‚  updated_at                   â† Auto update timestamp                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Real-time Updates
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     REACT QUERY LAYER                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  useStatistics()  â—„â”€â”€â”€â”€ Query ['statistics'] â”€â”€â”€â”€ Supabase              â”‚
â”‚       â”‚                                                                   â”‚
â”‚       â”‚ Automatic Refetch on Mutation                                   â”‚
â”‚       â”‚                                                                   â”‚
â”‚  useActivityTracking()                                                   â”‚
â”‚       â”‚                                                                   â”‚
â”‚       â”œâ”€â”€ trackFlashcardSession() â”€â”€â–º supabase.rpc('increment_...')     â”‚
â”‚       â”‚                                                                   â”‚
â”‚       â”œâ”€â”€ updateMostStudiedLevel() â”€â”€â–º supabase.rpc('update_...')       â”‚
â”‚       â”‚                                                                   â”‚
â”‚       â””â”€â”€ invalidateQueries(['statistics']) â”€â”€â–º Refetch Data            â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATISTICS PAGE UI                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  /statistics                                                             â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“š Reading â”‚  â”‚ ğŸ§ Listeningâ”‚  â”‚  ğŸ¯ Quizzes â”‚  â”‚  ğŸ“ Words   â”‚   â”‚
â”‚  â”‚     {n}     â”‚  â”‚     {n}     â”‚  â”‚     {n}     â”‚  â”‚     {n}     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ğŸ“ˆ Activitiesâ”‚  â”‚ ğŸ“… Active   â”‚  â”‚ ğŸ¯ Success  â”‚                     â”‚
â”‚  â”‚     {n}     â”‚  â”‚   Days {n}  â”‚  â”‚   Rate {%}  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                           â”‚
â”‚  Real-time updates via React Query                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TRACKING FLOW                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     AUTOMATIC TRACKING (95%)                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                         â•‘
â•‘  User Action          Database Insert         Trigger Fires            â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â–º   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â–º  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â•‘
â•‘                                                                         â•‘
â•‘  1. Complete Reading                                                   â•‘
â•‘     â””â”€â–º INSERT user_progress â”€â”€â–º trigger_reading_completed()          â•‘
â•‘         (content_type='reading')     â””â”€â–º +1 total_reading_completed   â•‘
â•‘                                                                         â•‘
â•‘  2. Complete Listening                                                 â•‘
â•‘     â””â”€â–º INSERT user_progress â”€â”€â–º trigger_listening_completed()        â•‘
â•‘         (content_type='listening')   â””â”€â–º +1 total_listening_completed â•‘
â•‘                                                                         â•‘
â•‘  3. Complete Quiz                                                      â•‘
â•‘     â””â”€â–º INSERT user_quiz_attempts â”€â”€â–º trigger_quiz_completed()        â•‘
â•‘         (score=8)                     â”œâ”€â–º +1 total_quizzes_completed  â•‘
â•‘                                       â””â”€â–º +8 total_quiz_score          â•‘
â•‘                                                                         â•‘
â•‘  4. Add Word                                                           â•‘
â•‘     â””â”€â–º INSERT user_words â”€â”€â–º trigger_word_added()                    â•‘
â•‘                                â””â”€â–º +1 total_words_added                â•‘
â•‘                                                                         â•‘
â•‘  5. Delete Word                                                        â•‘
â•‘     â””â”€â–º DELETE user_words â”€â”€â–º trigger_word_deleted()                  â•‘
â•‘                                â””â”€â–º -1 total_words_added                â•‘
â•‘                                                                         â•‘
â•‘  6. Any Activity on New Day                                            â•‘
â•‘     â””â”€â–º Any trigger â”€â”€â–º update_usage_days()                           â•‘
â•‘         (if date changed)  â””â”€â–º +1 total_usage_days                    â•‘
â•‘                                                                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     MANUAL TRACKING (5%)                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                         â•‘
â•‘  User Action          React Hook              RPC Function             â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â–º   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â–º   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â•‘
â•‘                                                                         â•‘
â•‘  1. Complete Flashcard Practice                                       â•‘
â•‘     â””â”€â–º trackFlashcardSession() â”€â”€â–º increment_flashcard_practice()   â•‘
â•‘         (useActivityTracking hook)   â””â”€â–º +1 flashcard_practice_count â•‘
â•‘                                                                         â•‘
â•‘  2. Update Most Studied Level (Optional)                              â•‘
â•‘     â””â”€â–º updateMostStudiedLevel() â”€â”€â–º update_most_studied_level()     â•‘
â•‘         (useActivityTracking hook)   â””â”€â–º Calculate & update level    â•‘
â•‘                                                                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA FLOW DIAGRAM                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    User Interface Layer
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ AddWordDialog, QuizContainer, Reading/Listening Pages
    â”‚
    â–¼
    
    Application Layer
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ React Components + Hooks
    â”‚   - useActivityTracking() [Manual]
    â”‚   - useStatistics() [Query]
    â”‚
    â–¼
    
    API Layer
    â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ Supabase Client
    â”‚   - Database inserts (automatic triggers)
    â”‚   - RPC calls (manual tracking)
    â”‚
    â–¼
    
    Database Layer
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”œâ”€â–º PostgreSQL Triggers (Automatic)
    â”‚   â””â”€â–º Execute on INSERT/DELETE
    â”‚
    â”œâ”€â–º RPC Functions (Manual)
    â”‚   â””â”€â–º Execute on explicit call
    â”‚
    â””â”€â–º user_statistics table
        â””â”€â–º Single source of truth


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTEGRATION POINTS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Already Working:
â”œâ”€ src/app/(main)/my-words/page.tsx
â”‚  â”œâ”€ AddWordDialog â†’ INSERT user_words â†’ trigger_word_added()
â”‚  â””â”€ Delete button â†’ DELETE user_words â†’ trigger_word_deleted()
â”‚
â””â”€ src/app/(main)/statistics/page.tsx
   â””â”€ Displays all statistics in real-time

ğŸ”¨ Needs Integration:
â”œâ”€ [FIND] Flashcard practice component
â”‚  â””â”€ Add: trackFlashcardSession() on completion
â”‚
â””â”€ [OPTIONAL] Reading/Listening/Quiz completion handlers
   â””â”€ Add: updateMostStudiedLevel() after completion


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SECURITY MODEL                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Row Level Security (RLS)
â”œâ”€ user_statistics table
â”‚  â”œâ”€ SELECT: Users can read their own statistics
â”‚  â”œâ”€ UPDATE: Users can update their own statistics
â”‚  â””â”€ INSERT: Users can create their own statistics
â”‚
Database Functions (SECURITY DEFINER)
â”œâ”€ increment_flashcard_practice()
â”‚  â””â”€ Validates: auth.uid() must exist
â”‚
â””â”€ update_most_studied_level()
   â””â”€ Validates: auth.uid() must exist


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PERFORMANCE CONSIDERATIONS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Optimizations:
â”œâ”€ Triggers execute in single transaction (fast)
â”œâ”€ UPSERT pattern prevents duplicate records
â”œâ”€ Indexed user_id for fast lookups
â”œâ”€ React Query caching reduces API calls
â””â”€ Optimistic updates for better UX


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FILE STRUCTURE                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

learn-quiz-english/
â”œâ”€ src/
â”‚  â”œâ”€ app/(main)/statistics/page.tsx .................... Display Layer
â”‚  â”œâ”€ features/statistics/
â”‚  â”‚  â”œâ”€ hooks/
â”‚  â”‚  â”‚  â”œâ”€ useStatistics.ts ............................ Query Hook
â”‚  â”‚  â”‚  â””â”€ useActivityTracking.ts ...................... Mutation Hooks
â”‚  â”‚  â”œâ”€ services/
â”‚  â”‚  â”‚  â””â”€ statisticsService.ts ........................ API Service
â”‚  â”‚  â”œâ”€ utils/
â”‚  â”‚  â”‚  â””â”€ trackActivity.ts ............................. Core Functions
â”‚  â”‚  â””â”€ INTEGRATION_EXAMPLES.tsx ....................... Code Examples
â”‚  â””â”€ scripts/
â”‚     â”œâ”€ statistics_triggers.sql ........................ Database Setup
â”‚     â””â”€ verify_statistics_system.sql ................... Verification
â”œâ”€ STATISTICS_TRACKING_SYSTEM.md ...................... Full Documentation
â”œâ”€ QUICK_START_STATISTICS.md .......................... Quick Guide
â”œâ”€ IMPLEMENTATION_CHECKLIST.md ........................ Step-by-Step
â””â”€ STATISTICS_ARCHITECTURE.md (this file) ............. Architecture

```

## Key Design Decisions

### 1. **Trigger-Based Approach**
- âœ… **Pro:** Automatic, reliable, no code changes
- âœ… **Pro:** Impossible to miss events
- âœ… **Pro:** Single source of truth
- âš ï¸ **Con:** Requires database access to modify

### 2. **Hybrid System (95% Auto + 5% Manual)**
- âœ… Most common activities are automatic
- âœ… Special cases (flashcards) use manual tracking
- âœ… Fallback available if triggers fail

### 3. **Single Statistics Table**
- âœ… Simple queries
- âœ… Fast aggregation
- âœ… Easy to display
- âœ… One row per user

### 4. **React Query Integration**
- âœ… Automatic cache invalidation
- âœ… Real-time updates
- âœ… Optimistic updates
- âœ… Error handling

### 5. **Security Definer Functions**
- âœ… Secure RPC calls
- âœ… User authentication verified
- âœ… RLS policies enforced
- âœ… Prevent unauthorized updates

---

## System Benefits

1. **Automatic** - 95% of tracking happens without code
2. **Accurate** - Database triggers never miss events
3. **Real-time** - React Query provides instant updates
4. **Secure** - RLS policies protect user data
5. **Performant** - Triggers execute in milliseconds
6. **Maintainable** - Clear separation of concerns
7. **Extensible** - Easy to add new statistics
8. **Reliable** - Single source of truth in database

---

## Extending the System

### Adding New Statistics

**Option 1: Automatic (Recommended)**
1. Add column to `user_statistics` table
2. Create trigger on relevant table
3. Update UI to display new stat

**Option 2: Calculated (No DB Change)**
1. Calculate in React component from existing data
2. Example: `totalActivities = reading + listening + quizzes`

**Option 3: Manual Tracking**
1. Create new RPC function in SQL
2. Add hook in `useActivityTracking.ts`
3. Call hook from React component

---

## Monitoring & Debugging

### Real-time Monitoring
```sql
-- Watch statistics change in real-time
SELECT * FROM user_statistics 
WHERE user_id = auth.uid();
```

### Trigger Debugging
```sql
-- Check if triggers fired
SELECT * FROM pg_stat_user_tables 
WHERE schemaname = 'public';
```

### Performance Monitoring
```sql
-- Check query performance
EXPLAIN ANALYZE 
SELECT * FROM user_statistics 
WHERE user_id = 'some-uuid';
```

---

**Last Updated:** [Date]  
**Version:** 1.0  
**Status:** Production Ready ğŸš€
